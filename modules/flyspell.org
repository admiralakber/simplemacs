#+TITLE: flyspell: Spell checking in emacs
#+AUTHOR: Aqeel Akber

* flyspell

=flyspell= provides on the fly spell checking. It's also apparently a
complete pain to set up for some insane reason. I stole this entirely
from [[https://github.com/pmRed/dotfiles][Github:pmRed/dotfiles]]

#+BEGIN_SRC emacs-lisp
  (use-package flyspell :ensure t
               :defer t
               :init
               ;; Config Stolen : make this nicer
               ;; if (aspell installed) { use aspell}
               ;; else if (hunspell installed) { use hunspell }
               ;; whatever spell checker I use, I always use English dictionary
               ;; I prefer use aspell because:
               ;; 1. aspell is older
               ;; 2. looks Kevin Atkinson still get some road map for aspell:
               ;; @see http://lists.gnu.org/archive/html/aspell-announce/2011-09/msg00000.html
               (defun flyspell-detect-ispell-args (&optional run-together)
                 "if RUN-TOGETHER is true, spell check the CamelCase words."
                 (let (args)
                   (cond
                    ((string-match  "aspell$" ispell-program-name)
                     ;; Force the English dictionary for aspell
                     ;; Support Camel Case spelling check (tested with aspell 0.6)
                     (setq args (list "--sug-mode=ultra" "--lang=en_AU"))
                     (if run-together
                         (setq args (append args '("--run-together" "--run-together-limit=5" "--run-together-min=2")))))
                    ((string-match "hunspell$" ispell-program-name)
                     ;; Force the English dictionary for hunspell
                     (setq args "-d en_AU")))
                   args))

               (cond
                ((executable-find "aspell")
                 ;; you may also need `ispell-extra-args'
                 (setq ispell-program-name "aspell"))
                ((executable-find "hunspell")
                 (setq ispell-program-name "hunspell")

                 ;; Please note that `ispell-local-dictionary` itself will be passed to hunspell cli with "-d"
                 ;; it's also used as the key to lookup ispell-local-dictionary-alist
                 ;; if we use different dictionary
                 (setq ispell-local-dictionary "en_AU")
                 (setq ispell-local-dictionary-alist
                       '(("en_AU" "[[:alpha:]]" "[^[:alpha:]]" "[']" nil ("-d" "en_AU") nil utf-8))))
                (t (setq ispell-program-name nil)))

               ;; ispell-cmd-args is useless, it's the list of *extra* arguments we will append to the ispell process when "ispell-word" is called.
               ;; ispell-extra-args is the command arguments which will *always* be used when start ispell process
               ;; Please note when you use hunspell, ispell-extra-args will NOT be used.
               ;; Hack ispell-local-dictionary-alist instead.
               (setq-default ispell-extra-args (flyspell-detect-ispell-args t))
               ;; (setq ispell-cmd-args (flyspell-detect-ispell-args))
               (defadvice ispell-word (around my-ispell-word activate)
                 (let ((old-ispell-extra-args ispell-extra-args))
                   (ispell-kill-ispell t)
                   (setq ispell-extra-args (flyspell-detect-ispell-args))
                   ad-do-it
                   (setq ispell-extra-args old-ispell-extra-args)
                   (ispell-kill-ispell t)
                   ))

               (defadvice flyspell-auto-correct-word (around my-flyspell-auto-correct-word activate)
                 (let ((old-ispell-extra-args ispell-extra-args))
                   (ispell-kill-ispell t)
                   ;; use emacs original arguments
                   (setq ispell-extra-args (flyspell-detect-ispell-args))
                   ad-do-it
                   ;; restore our own ispell arguments
                   (setq ispell-extra-args old-ispell-extra-args)
                   (ispell-kill-ispell t)
                   ))

               (defun text-mode-hook-setup ()
                 ;; Turn off RUN-TOGETHER option when spell check text-mode
                 (setq-local ispell-extra-args (flyspell-detect-ispell-args)))
               (add-hook 'text-mode-hook 'text-mode-hook-setup)
               (flyspell-mode 1)
               :config
               )
#+END_SRC
